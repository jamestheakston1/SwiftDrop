<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwiftDrop | iPhone to Android Transfer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @keyframes pulse-ring {
            0% { transform: scale(0.33); opacity: 1; }
            80%, 100% { opacity: 0; }
        }
        .radar-ring {
            animation: pulse-ring 3s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .device-node:hover {
            transform: scale(1.05);
            transition: all 0.3s ease;
        }
        .gradient-text {
            background: linear-gradient(90deg, #2563eb, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        #app-view { display: none; }
        #qrcode img { margin: 0 auto; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen font-sans overflow-x-hidden">

    <div id="landing-view">
        <nav class="fixed top-0 w-full glass z-50 px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-blue-600 p-2 rounded-xl text-white">
                    <i data-feather="share-2" class="w-5 h-5"></i>
                </div>
                <span class="font-bold text-xl tracking-tight">SwiftDrop</span>
            </div>
            <div class="hidden md:flex gap-8 font-medium text-slate-600">
                <a href="#" class="hover:text-blue-600 transition-colors">Cross-Platform</a>
                <a href="#" class="hover:text-blue-600 transition-colors">Security</a>
                <a href="#" class="hover:text-blue-600 transition-colors">Speed</a>
            </div>
            <button onclick="navigateToApp()" class="bg-blue-600 text-white px-6 py-2 rounded-full font-semibold hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all text-sm md:text-base">
                Launch App
            </button>
        </nav>

        <section class="pt-32 pb-20 px-6 max-w-6xl mx-auto flex flex-col items-center text-center">
            <div class="inline-flex items-center gap-2 bg-indigo-50 text-indigo-600 px-4 py-1.5 rounded-full text-sm font-bold mb-8">
                <i data-feather="smartphone" class="w-4 h-4"></i>
                iPhone â†” Android Bridge
            </div>
            <h1 class="text-5xl md:text-7xl font-black tracking-tight mb-6 max-w-4xl leading-tight">
                Finally, AirDrop for <span class="gradient-text">Everyone.</span>
            </h1>
            <p class="text-lg md:text-xl text-slate-500 max-w-2xl mb-10">
                The easiest way to move high-res photos and large files from iPhone to Android and back. No cables, no apps, no limits.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 mb-20">
                <button onclick="navigateToApp()" class="bg-slate-900 text-white px-10 py-4 rounded-2xl font-bold text-lg hover:bg-slate-800 transition-all flex items-center gap-2 justify-center">
                    Get Started <i data-feather="arrow-right"></i>
                </button>
                <div class="flex items-center gap-2 text-slate-400 text-sm font-medium px-4">
                    <i data-feather="link-2" class="w-4 h-4"></i>
                    swift-drop.pages.dev
                </div>
            </div>

            <div class="grid md:grid-cols-3 gap-8 w-full mb-20">
                <div class="bg-white p-8 rounded-3xl border border-slate-100 shadow-sm text-left">
                    <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center mb-6">
                        <i data-feather="repeat"></i>
                    </div>
                    <h3 class="font-bold text-xl mb-3">True Cross-Platform</h3>
                    <p class="text-slate-500">Bridging the gap between iOS and Android seamlessly. If it has a browser, it works.</p>
                </div>
                <div class="bg-white p-8 rounded-3xl border border-slate-100 shadow-sm text-left">
                    <div class="w-12 h-12 bg-green-100 text-green-600 rounded-xl flex items-center justify-center mb-6">
                        <i data-feather="maximize"></i>
                    </div>
                    <h3 class="font-bold text-xl mb-3">QR Handshake</h3>
                    <p class="text-slate-500">No more manual link sharing. Just scan the code from your other phone to link instantly.</p>
                </div>
                <div class="bg-white p-8 rounded-3xl border border-slate-100 shadow-sm text-left">
                    <div class="w-12 h-12 bg-amber-100 text-amber-600 rounded-xl flex items-center justify-center mb-6">
                        <i data-feather="cpu"></i>
                    </div>
                    <h3 class="font-bold text-xl mb-3">Direct Speed</h3>
                    <p class="text-slate-500">Uses your local Wi-Fi bandwidth for the fastest possible transfer speeds between devices.</p>
                </div>
            </div>

            <div class="bg-slate-900 rounded-[3rem] p-8 md:p-16 text-white w-full flex flex-col md:flex-row items-center gap-12 text-left">
                <div class="flex-1">
                    <h2 class="text-3xl md:text-5xl font-bold mb-6">Built for the iPhone to Android switch.</h2>
                    <p class="text-slate-400 text-lg mb-8 leading-relaxed">
                        Moving files between ecosystems shouldn't be hard. SwiftDrop creates a secure P2P tunnel between any two browsers, allowing for bulk transfers of 4K video, RAW photos, and massive documents in seconds.
                    </p>
                    <div class="flex gap-4">
                        <div class="flex items-center gap-2 text-sm font-medium"><i data-feather="check" class="text-blue-400"></i> No Data usage</div>
                        <div class="flex items-center gap-2 text-sm font-medium"><i data-feather="check" class="text-blue-400"></i> No account</div>
                    </div>
                </div>
                <div class="w-full md:w-1/3 flex justify-center">
                    <div class="bg-white/10 p-6 rounded-3xl backdrop-blur-md border border-white/20 text-center">
                        <div id="landing-qr" class="bg-white p-2 rounded-xl mb-4"></div>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-tighter">Scan to open on your phone</p>
                    </div>
                </div>
            </div>
        </section>

        <footer class="py-12 px-6 border-t border-slate-200 text-center text-slate-500 text-sm">
            &copy; 2025 SwiftDrop (swift-drop.pages.dev). Private. Secure. Peer-to-Peer.
        </footer>
    </div>

    <div id="app-view">
        <nav class="fixed top-0 w-full glass z-50 px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <button onclick="navigateToLanding()" class="p-2 hover:bg-slate-100 rounded-lg mr-2">
                    <i data-feather="chevron-left" class="w-5 h-5"></i>
                </button>
                <div class="bg-blue-600 p-2 rounded-xl text-white">
                    <i data-feather="share-2" class="w-5 h-5"></i>
                </div>
                <span class="font-bold text-xl tracking-tight">SwiftDrop P2P</span>
            </div>
            <div class="flex items-center gap-4">
                <div id="connStatus" class="flex items-center gap-2 bg-slate-100 text-slate-500 px-4 py-2 rounded-full text-sm font-medium border border-slate-200">
                    <span class="w-2 h-2 bg-slate-400 rounded-full"></span>
                    Disconnected
                </div>
            </div>
        </nav>

        <div id="setupScreen" class="fixed inset-0 z-[60] glass flex items-center justify-center p-6 mt-16 overflow-y-auto">
            <div class="max-w-md w-full text-center py-10">
                <div class="w-20 h-20 bg-blue-600 text-white rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-xl">
                    <i data-feather="wifi" class="w-10 h-10"></i>
                </div>
                <h1 class="text-3xl font-bold mb-2">Connect Devices</h1>
                <p class="text-slate-500 mb-8">Scan the code on your other phone to link them via WebRTC.</p>
                
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 flex flex-col items-center">
                        <div id="qrcode" class="mb-4 p-2 bg-white rounded-xl"></div>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Or use Manual Code</p>
                        <div class="flex gap-2 w-full">
                            <input id="myIdDisplay" readonly class="flex-1 bg-slate-50 border-none text-xs font-mono p-3 rounded-xl focus:ring-0" value="Generating...">
                            <button onclick="copyMyId()" class="bg-blue-50 text-blue-600 p-3 rounded-xl hover:bg-blue-100 transition-colors">
                                <i data-feather="copy" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-3xl border border-slate-200 text-left">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Connect to Peer ID</p>
                        <div class="flex gap-2">
                            <input id="peerIdInput" class="flex-1 bg-slate-50 border-none text-sm font-mono p-3 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Paste ID here...">
                            <button onclick="connectToPeer()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700 transition-colors">
                                Connect
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <main class="relative h-screen w-full flex flex-col items-center justify-center p-6">
            <div id="radarContainer" class="relative w-full max-w-2xl aspect-square flex items-center justify-center">
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <div class="radar-ring absolute w-[30%] aspect-square border border-blue-200 rounded-full"></div>
                    <div class="radar-ring absolute w-[60%] aspect-square border border-blue-200 rounded-full" style="animation-delay: 1s"></div>
                </div>

                <div class="relative z-10 text-center">
                    <div class="w-24 h-24 bg-white rounded-3xl shadow-2xl flex items-center justify-center mx-auto mb-4 border border-slate-100">
                        <i data-feather="smartphone" class="w-10 h-10 text-blue-600"></i>
                    </div>
                    <h2 class="text-xl font-semibold">Drop Hub</h2>
                    <p class="text-slate-500 text-sm" id="peerName">Waiting for connection...</p>
                </div>

                <div id="devices" class="absolute inset-0"></div>
            </div>
        </main>
    </div>

    <div id="transferModal" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
        <div class="glass max-w-md w-full rounded-3xl p-8 shadow-2xl scale-95 transition-transform duration-300">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h3 class="text-2xl font-bold">Transfer File</h3>
                    <p class="text-slate-500">P2P Encrypted Channel</p>
                </div>
                <button onclick="closeModal()" class="p-2 hover:bg-slate-100 rounded-full">
                    <i data-feather="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div id="dropZone" class="border-2 border-dashed border-slate-200 rounded-2xl p-10 text-center hover:border-blue-400 hover:bg-blue-50/50 transition-all cursor-pointer group mb-6">
                <input type="file" id="fileInput" class="hidden" onchange="handleFiles(this.files)">
                <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                    <i data-feather="upload-cloud" class="w-8 h-8"></i>
                </div>
                <p class="font-medium">Drop files here</p>
                <p class="text-xs text-slate-400 mt-2">Maximum speed via direct link</p>
            </div>

            <div id="transferProgress" class="hidden">
                <div class="flex justify-between text-sm mb-2 font-medium">
                    <span id="progressText" class="text-blue-600">Sending...</span>
                    <span id="percentText">0%</span>
                </div>
                <div class="w-full bg-slate-100 h-3 rounded-full overflow-hidden">
                    <div id="progressBar" class="bg-blue-600 h-full w-0 transition-all duration-300 shadow-[0_0_10px_rgba(37,99,235,0.4)]"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 glass px-6 py-4 rounded-2xl shadow-lg border border-slate-200 translate-y-32 transition-transform duration-500 flex items-center gap-3 z-[200]">
        <div class="w-2.5 h-2.5 bg-green-500 rounded-full"></div>
        <span id="toastMsg" class="text-sm font-semibold"></span>
    </div>

    <script>
        let peerConnection;
        let dataChannel;
        let qrCode;
        let landingQR;
        let localId = Math.random().toString(36).substring(2, 8).toUpperCase();
        const iceServers = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };
        const APP_URL = "https://swift-drop.pages.dev";

        function navigateToApp() {
            document.getElementById('landing-view').style.display = 'none';
            document.getElementById('app-view').style.display = 'block';
            window.scrollTo(0,0);
            if (!qrCode) {
                generateQRCode(localId);
            }
        }

        function navigateToLanding() {
            document.getElementById('app-view').style.display = 'none';
            document.getElementById('landing-view').style.display = 'block';
        }

        function generateQRCode(text) {
            const container = document.getElementById('qrcode');
            container.innerHTML = "";
            qrCode = new QRCode(container, {
                text: text,
                width: 180,
                height: 180,
                colorDark : "#0f172a",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }

        function init() {
            feather.replace();
            document.getElementById('myIdDisplay').value = localId;
            
            const landingContainer = document.getElementById('landing-qr');
            new QRCode(landingContainer, {
                text: APP_URL,
                width: 160,
                height: 160,
                colorDark : "#0f172a",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });

            setupWebRTC();
        }

        function setupWebRTC() {
            peerConnection = new RTCPeerConnection(iceServers);
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    const signal = btoa(JSON.stringify(peerConnection.localDescription));
                    document.getElementById('myIdDisplay').value = signal;
                    generateQRCode(signal);
                }
            };
            peerConnection.ondatachannel = (event) => {
                receiveChannelCallback(event.channel);
            };
            peerConnection.onconnectionstatechange = () => {
                updateUIStatus(peerConnection.connectionState);
            };
        }

        async function connectToPeer() {
            const remoteSignal = document.getElementById('peerIdInput').value.trim();
            if (!remoteSignal) return;
            try {
                const desc = new RTCSessionDescription(JSON.parse(atob(remoteSignal)));
                if (desc.type === 'offer') {
                    await peerConnection.setRemoteDescription(desc);
                    const answer = await peerConnection.createAnswer();
                    await peerConnection.setLocalDescription(answer);
                    const signal = btoa(JSON.stringify(peerConnection.localDescription));
                    document.getElementById('myIdDisplay').value = signal;
                    generateQRCode(signal);
                    showToast("Answer generated! Share the code back.");
                } else if (desc.type === 'answer') {
                    await peerConnection.setRemoteDescription(desc);
                }
            } catch (e) {
                showToast("Connection failed. Check code format.");
            }
        }

        function createOffer() {
            dataChannel = peerConnection.createDataChannel("fileTransfer");
            setupDataChannel(dataChannel);
            peerConnection.createOffer().then(offer => {
                return peerConnection.setLocalDescription(offer);
            }).then(() => {
                const signal = btoa(JSON.stringify(peerConnection.localDescription));
                document.getElementById('myIdDisplay').value = signal;
                generateQRCode(signal);
            });
        }

        function setupDataChannel(channel) {
            channel.onopen = () => {
                document.getElementById('setupScreen').classList.add('hidden');
                updateUIStatus('connected');
                renderDeviceNode();
            };
            channel.onmessage = handleIncomingData;
        }

        function receiveChannelCallback(channel) {
            dataChannel = channel;
            setupDataChannel(dataChannel);
        }

        function handleIncomingData(event) {
            const data = JSON.parse(event.data);
            if (data.type === 'file-start') {
                window.incomingFile = { name: data.name, size: data.size, chunks: [] };
            } else if (data.type === 'file-chunk') {
                window.incomingFile.chunks.push(data.chunk);
                if (window.incomingFile.chunks.length === data.totalChunks) {
                    finalizeDownload();
                }
            }
        }

        function finalizeDownload() {
            const blob = new Blob(window.incomingFile.chunks.map(c => Uint8Array.from(atob(c), c => c.charCodeAt(0))));
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = window.incomingFile.name;
            a.click();
            showToast(`Received: ${window.incomingFile.name}`);
        }

        function renderDeviceNode() {
            const container = document.getElementById('devices');
            container.innerHTML = `
                <div class="device-node absolute top-[15%] left-[50%] -translate-x-1/2 flex flex-col items-center gap-2 cursor-pointer" onclick="openTransfer()">
                    <div class="w-16 h-16 bg-white rounded-2xl shadow-lg flex items-center justify-center border border-slate-100">
                        <i data-feather="smartphone" class="w-7 h-7 text-blue-600"></i>
                    </div>
                    <span class="text-xs font-bold bg-white px-2 py-1 rounded-full shadow-sm border border-slate-50">Cross-Platform Linked</span>
                </div>
            `;
            feather.replace();
            document.getElementById('peerName').innerText = "Direct P2P Link Active";
        }

        function updateUIStatus(state) {
            const status = document.getElementById('connStatus');
            if (state === 'connected') {
                status.innerHTML = `<span class="w-2 h-2 bg-green-500 rounded-full"></span> Connected`;
                status.classList.replace('text-slate-500', 'text-green-600');
            } else {
                status.innerHTML = `<span class="w-2 h-2 bg-slate-400 rounded-full"></span> ${state}`;
            }
        }

        function handleFiles(files) {
            if (!files.length || !dataChannel || dataChannel.readyState !== 'open') return;
            const file = files[0];
            const reader = new FileReader();
            const chunkSize = 16384; 
            document.getElementById('dropZone').classList.add('hidden');
            document.getElementById('transferProgress').classList.remove('hidden');
            reader.onload = async (e) => {
                const buffer = e.target.result;
                const totalChunks = Math.ceil(buffer.byteLength / chunkSize);
                dataChannel.send(JSON.stringify({ type: 'file-start', name: file.name, size: file.size }));
                for (let i = 0; i < totalChunks; i++) {
                    const start = i * chunkSize;
                    const end = Math.min(start + chunkSize, buffer.byteLength);
                    const chunk = buffer.slice(start, end);
                    dataChannel.send(JSON.stringify({
                        type: 'file-chunk',
                        chunk: btoa(String.fromCharCode(...new Uint8Array(chunk))),
                        totalChunks: totalChunks
                    }));
                    let progress = ((i + 1) / totalChunks) * 100;
                    document.getElementById('progressBar').style.width = `${progress}%`;
                    document.getElementById('percentText').innerText = `${Math.round(progress)}%`;
                }
                showToast("Sent successfully!");
                setTimeout(closeModal, 1000);
            };
            reader.readAsArrayBuffer(file);
        }

        function openTransfer() {
            document.getElementById('transferModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('transferModal').style.display = 'none';
            document.getElementById('dropZone').classList.remove('hidden');
            document.getElementById('transferProgress').classList.add('hidden');
        }

        function copyMyId() {
            const input = document.getElementById('myIdDisplay');
            input.select();
            document.execCommand('copy');
            showToast("Signal ID copied!");
            if (peerConnection.localDescription === null) {
                createOffer();
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            toast.style.transform = 'translate(-50%, -40px)';
            setTimeout(() => toast.style.transform = 'translate(-50%, 128px)', 3000);
        }

        window.onload = init;
    </script>
</body>
</html>
